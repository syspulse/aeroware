package io.syspulse.aeroware.sigmet

import org.scalatest.wordspec.{ AnyWordSpec}
import org.scalatest.matchers.should.{ Matchers}
import org.scalatest.flatspec.AnyFlatSpec

import java.time._
import java.time.format._
import java.time.temporal._

import io.jvm.uuid._

import io.syspulse.skel.util.Util

import io.syspulse.aeroware.sigmet._

import scala.util._
import scala.io.Source

import fastparse._, NoWhitespace._
import org.scalactic.TolerantNumerics

class SigmetSpec extends AnyWordSpec with Matchers {
  implicit val doubleEquality = TolerantNumerics.tolerantDoubleEquality(0.0001)
  
  val TEST_DIR = os.Path(this.getClass.getClassLoader.getResource(".").getPath + "/data")
  
  val SIGMET_1 = """WSSP32 LEMM 191022
LECB SIGMET 3 VALID 191100/191500 LEVA-
LECB BARCELONA UIR SEV TURB FCST WI N4024 E00441 - N3756 E00221
- N36 W00207 - N4240 E00118 - N4201 E00438 - N4024 E00441
FL210/330 MOV E  NC="""

  val SIGMET_20 = List(
	 "WSTH31 VTBS 121200 CCA VHHK SIGMET 4 VALID 031200/031600 VHHH- VHHK HONG KONG FIR EMBD TS FCST S OF N20 E OF E112 TOP FL360 STNR NC="
	,"WSSR20 WSSS 091131 WSJC SIGMET 3 VALID 091140/091540 WSSS- WSJC SINGAPORE FIR EMBD TS OBS AT 1130Z N OF N01 E OF E106 W OF E114 STNR NC="
	,"WSNT03 KKCI 032340 KZNY SIGMET C17 VALID 032345/040345 KKCI- KZNY NEW YORK OCEANIC FIR FRQ TS OBS WI AREA N2400 W05500 - N2300 W04930 - N1845 W05645 - N2100 W05800 - N2400 W05500 TOP FL450 MOV E 15KT INTSF="
	,"WSVS31 VVGL 122305 VVTS SIGMET 9 VALID 122330/130230 VVGL- VVTS HOCHIMINH FIR EMBD TS OBS S OF LINE N1420 E10930 - N1000 E10400 TOP FL280 MOV W 10KMH WKN="
	,"WSUK31 EGGY 121120 EGTT SIGMET 01 VALID 121125/121525 EGRR- EGTT LONDON FIR EMBD TSGR OBS AT 1115Z SE OF LINE N5130 E00200 - N5000 W00400 TOPS FL220 MOV NE 30KT NC="
	,"WSAU21 AMMC 280546 YBBB SIGMET BS02 VALID 280600/281000 YMMC- YBBB BRISBANE FIR SEV TURB FCST AT 0600Z WI S3900 E15100 - S4300 E15100 - S4300 E16000 - S4100 E16300 - S3700 E16300 - S3900 E16000 FL260/370 MOV E 20 KT NC="
	,"EDUU	SIGMET 1 VALID 050200/050400 EDZF- EDUU RHEIN UIR SEV TURB FCST NE OF LINE N5415 E01130 - N5320 E01425 FL245/350 MOV NE NC="
	,"EGTT	SIGMET 04 VALID 042300/050300 EGRR- EGTT LONDON FIR SEV TURB FCST S OF LINE N5000 W00800 - N5030 W00700 - N2030 W00500 - N4930 W00400 BLW FL060 MOV E 45KT INTSF="
	,"EGTT	SIGMET 01 VALID 050300/050700 EGRR- EGTT LONDON FIR SEV TURB OBS S OF LINE N4900 W00800 - N5000 W00400 - N5100 W00300 - N5200 W00100 - N5130 E00100 - N5100 E00130 BLW FL060 MOV ENE 45KT NC="
	,"EKDK	SIGMET 1 VALID 050025/050425 EKMI- EKDK COPENHAGEN FIR SEV TURB FCST AT 0020Z WITHIN 40NM OF LINE N57 E00609 - N5606 E01041 - N5501 E01247 FL240-390 MOV NE 15KT NC="
	,"LFFF	SIGMET 3 VALID 050100/050400 LFPW- LFFF PARIS FIR/UIR SEV TURB FCST N OF N4930 AND W OF E00000 SFC/FL050 MOV E 30KT INTSF="
	,"LFRR	SIGMET 1 VALID 050100/050400 LFPW- LFRR BREST FIR/UIR SEV TURB FCST WI N4930 W00415 - N5000 W00200 - N5000 W00015 - N4930 W00015 - N4845 W00400 SFC/FL050 MOV E 30KT INTSF ="
	,"LIRR	SIGMET 01 VALID 050130/050530 LIMM- LIRR ROMA FIR VA CLD OBS AT 040430Z WI 15 NM ESE OF ETNA (N3745 E1500) FL090/130 MOV SE 15 KT="
	)

"Sigmet" should {
    
    "parse 'SIGMET_1'" in {
      val s1 = Sigmet.decode(SIGMET_1)
      info(s"${s1}")
      s1.isSuccess should === (true)
    }    
  }

}
